# 属性注册表系统

属性注册表（statusMap）是游戏中所有属性的定义和配置中心

## 设计目的

  统一管理所有游戏属性的定义
  为开发者提供类型提示和文档
  支持 mod 开发者注册自定义属性
  让属性可以被修饰器系统修改
  避免硬编码数值，提高可维护性

## 文件位置

```
src/static/list/system/statusMap.ts
```

## 属性定义结构

```typescript
{
    label: string              // 显示的文本
    value: number              // 起始值（默认值）
    describe?: string          // 属性描述（用于提示）
    category?: "base" | "combat" | "card" | "special"  // 属性分类
    notNegative?: boolean      // 非负（不能小于0）
    unstackable?: boolean      // 不可堆叠
    hidden?: boolean           // 是否隐藏（不在UI中显示）
}
```

简写形式：
```typescript
"health": 50  // 等价于 { label: "health", value: 50 }
```

## 属性分类

base - 基础属性
  health, max-health - 生命值
  energy, max-energy - 能量值
  max-potion - 药水上限

combat - 战斗属性
  strength - 力量（增加攻击伤害）
  dexterity - 敏捷（增加格挡值）
  block - 格挡值
  vulnerable - 易伤
  weak - 虚弱
  frail - 脆弱

card - 卡牌相关属性
  cost - 卡牌消耗
  draw-per-turn - 每回合抽牌数

special - 特殊属性
  action-order - 行动顺序
  ifBloodMark - 染血标记

## 核心函数

### getMap(key)

获取属性配置

```typescript
const config = getMap("draw-per-turn")
// 返回: { label: "每回合抽牌数", value: 5, ... }
```

### registerStatus(key, config)

注册自定义属性（供 mod 开发者使用）

```typescript
registerStatus("my-custom-stat", {
    label: "我的自定义属性",
    value: 0,
    describe: "这是一个自定义属性",
    category: "special"
})
```

### getAllStatusKeys()

获取所有已注册的属性键

```typescript
const keys = getAllStatusKeys()
// 返回: ["health", "max-health", "energy", ...]
```

### getStatusByCategory(category)

根据分类获取属性列表

```typescript
const combatStats = getStatusByCategory("combat")
// 返回: { strength: {...}, dexterity: {...}, ... }
```

## 使用场景

### 场景1：在角色/物品中定义属性

```typescript
// playerList.ts
{
    status: {
        "max-health": 50,
        "max-energy": 3,
        "draw-per-turn": 5  // 使用注册表中定义的属性
    }
}
```

### 场景2：在效果中动态读取属性

```typescript
// 触发器定义
{
    effect: [{
        key: "drawFromDrawPile",
        params: {
            value: { fromStatus: "draw-per-turn" }  // 从属性读取
        }
    }]
}
```

效果函数实现：
```typescript
export const drawFromDrawPile: EffectFunc = (event, effect) => {
    const valueParam = effect.params.value

    let number: number
    if (typeof valueParam === 'object' && 'fromStatus' in valueParam) {
        // 从属性读取
        number = getStatusValue(player, valueParam.fromStatus, 5)
    } else {
        // 直接使用数字
        number = valueParam as number
    }

    // ... 使用 number 执行抽牌逻辑
}
```

### 场景3：遗物修改属性（简单！）

```typescript
// relicList.ts - 学者之戒：每回合多抽2张牌
{
    label: "学者之戒",
    key: "original_relic_00004",
    interaction: {
        possess: {
            target: { key: "owner" },
            effects: [{
                key: "addStatusBase",
                params: {
                    statusKey: "draw-per-turn",
                    value: 2,              // 增加2点
                    type: "additive"       // 加法修饰器
                }
            }]
        }
    }
}
```

当玩家获得这个遗物时：
  自动为玩家的 "draw-per-turn" 属性添加 +2 修饰器
  回合开始时，抽牌数从 5 变成 7
  失去遗物时，修饰器自动移除，抽牌数恢复为 5

## 优势对比

### 旧方式（硬编码）

```typescript
// 触发器中硬编码抽5张牌
trigger: [{
    effect: [{ key: "drawFromDrawPile", params: { value: 5 } }]
}]

// 遗物想要修改抽牌数，需要替换整个触发器（繁琐！）
player.trigger.appendTrigger({
    onlyKey: "turnStart_drawCard",
    callback: (event) => {
        doEvent({
            effectUnits: [{ key: "drawFromDrawPile", params: { value: 7 } }]
        })
    }
})
```

### 新方式（基于属性）

```typescript
// 触发器读取属性
trigger: [{
    effect: [{
        key: "drawFromDrawPile",
        params: { value: { fromStatus: "draw-per-turn" } }
    }]
}]

// 遗物只需要修改属性（简单！）
effects: [{
    key: "addStatusBase",
    params: { statusKey: "draw-per-turn", value: 2, type: "additive" }
}]
```

优势：
  遗物只需要修改属性，不需要操作触发器
  多个遗物的效果可以叠加（如 +1 抽牌 + +2 抽牌 = +3）
  属性可以在 UI 中显示
  符合项目的修饰器系统设计

## 扩展指南

### 添加新的内置属性

编辑 `statusMap.ts`，在 `statusMapList` 中添加：

```typescript
export const statusMapList: Record<string, StatusMap> = {
    // ... 现有属性

    "my-new-stat": {
        label: "我的新属性",
        value: 0,
        describe: "这是一个新属性",
        category: "special",
        notNegative: true
    }
}
```

### Mod 开发者注册自定义属性

在 mod 初始化代码中：

```typescript
import { registerStatus } from "@/static/list/system/statusMap"

// 注册自定义属性
registerStatus("mod-custom-stat", {
    label: "Mod自定义属性",
    value: 10,
    describe: "这是mod添加的属性",
    category: "special"
})
```

### 让效果函数支持动态属性读取

在效果函数中添加属性读取逻辑：

```typescript
export const myEffect: EffectFunc = (event, effect) => {
    const valueParam = effect.params.value

    let actualValue: number
    if (typeof valueParam === 'object' && 'fromStatus' in valueParam) {
        // 从属性读取
        const { getStatusValue } = require("@/core/objects/system/status/Status")
        actualValue = getStatusValue(target, valueParam.fromStatus, defaultValue)
    } else {
        // 直接使用
        actualValue = valueParam as number
    }

    // 使用 actualValue 执行效果
}
```

## 注意事项

属性值的修改应该通过修饰器系统
  使用 addStatusModifier 添加修饰器
  不要直接修改 status 对象

属性的默认值定义在 statusMap 中
  角色/物品的 status 字段会覆盖默认值
  如果不指定，使用 statusMap 中的 value

属性分类是可选的
  主要用于组织和文档
  不影响功能

hidden 属性不会在 UI 中显示
  用于内部逻辑标记
  如 ifBloodMark（染血标记）

## 相关文件

属性定义：src/static/list/system/statusMap.ts
属性系统：src/core/objects/system/status/Status.ts
修饰器系统：src/core/objects/system/modifier/StatusModifier.ts
示例遗物：src/static/list/item/relicList.ts
