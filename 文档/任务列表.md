[toc]

当前任务：

## 战斗系统完善

### 战斗结束判定
- [ ] 实现死亡判定（角色/敌人生命值归0）
- [ ] 实现战斗失败流程（玩家死亡）
- [ ] 实现战斗胜利流程（所有敌人死亡）
- [ ] 实现死亡事件（death event）
- [ ] 实现复活机制（如瓶中精灵药水）

### 战斗奖励
- [ ] 实现战斗胜利奖励界面
- [ ] 实现金钱奖励
- [ ] 实现卡牌奖励选择
- [ ] 实现器官奖励选择
- [ ] 实现药水奖励

## 敌人系统

### 模块1：卡牌获取与标识系统 🎴
- [ ] Tag系统（卡牌分类标签）
  - [ ] CardMap 添加 tags 字段
  - [ ] 定义标准tag类型（attack/skill/power/basic等）
  - [ ] 给现有卡牌添加tag
  - [ ] 词条与tag的区分说明
- [ ] CardSelector 筛选器系统
  - [ ] 设计组合筛选器数据结构（方案2）
  - [ ] 支持按 key、tags、organ、effect、costRange 等筛选
  - [ ] 实现筛选逻辑函数
  - [ ] 支持随机选择和数量限制
- [ ] Enemy.getAvailableCards() 方法
- [ ] 初始卡牌机制（fallback卡牌）
- [ ] 测试器官损坏对卡牌可用性的影响

### 模块2：意图系统（完整）👁️
- [ ] Intent 类型定义
  - [ ] 基础意图类型（attack, defend, buff, debuff, unknown）
  - [ ] 意图类型注册表（可扩展，支持mod）
- [ ] IntentVisibility 可见性系统
  - [ ] 可见性等级：不可见/类型/范围/精确
  - [ ] 眼球器官控制可见性
- [ ] cardsToIntent 方法（从卡牌分析生成意图）
  - [ ] 分析卡牌效果类型
  - [ ] 计算数值（伤害/格挡等）
  - [ ] 支持多段攻击（count）
- [ ] 意图显示UI组件

### 模块3：AI行为配置系统（完整）🧠
- [ ] BehaviorPattern 配置数据结构
  - [ ] 条件判断系统（基于战斗状态）
  - [ ] 优先级和顺位机制（fallback）
  - [ ] 行动模式：随机选择、循环、顺序执行
- [ ] AI决策引擎（selectAction）
  - [ ] 解析配置
  - [ ] 条件评估
  - [ ] 卡牌筛选和选择
- [ ] 示例AI配置（简单/中等/复杂）

### 模块4：敌人行动执行 ⚔️
- [ ] executeIntent 方法（执行意图中的卡牌）
- [ ] 敌人回合逻辑
- [ ] 集成到战斗流程（玩家回合 ↔ 敌人回合）
- [ ] 多次行动机制（actions-per-turn）

### 模块5：敌人类型和数据 📊
- [ ] 敌人类型定义（Normal/Elite/Boss）
- [ ] 敌人示例数据
  - [ ] 普通敌人（简单AI）
  - [ ] 精英敌人（中等AI）
  - [ ] Boss敌人（复杂AI）
- [ ] 测试完整战斗流程

## 器官系统完善（优先级待定）⚠️ 部分完成

### 基础属性系统
- [ ] 添加器官属性（level, quality, mass, part, devourValue）
- [ ] 实现等级系统（maxLevel, 升级效果变化）
- [ ] 实现质量系统（当前质量、最大质量、质量归0触发损坏）
- [ ] 实现部位系统（part 互斥检查）

### 行为方法
- [ ] 实现同化方法（assimilateOrgan，消耗物质）
- [ ] 实现吞噬方法（devourOrgan，获得物质）
- [ ] 实现售卖方法（sellOrgan，获得金钱）
- [ ] 实现升级方法（upgradeOrgan，消耗物质提升等级）
- [ ] 实现修复方法（repairOrgan，消耗物质恢复质量）

### 卡牌集成 ✅ 已完成
- [x] 实现器官提供卡牌功能（通过 cards 属性）- Organ.ts 已实现
- [x] 实现损坏时卡牌无法打出的逻辑 - OrganModifier 已实现 work/broken 触发器切换

### 完善与测试
- [ ] 创建器官相关 effect（damageOrgan, healOrgan 等）
- [ ] 完善 OrganMap 类型（添加新属性）
- [ ] 添加器官示例数据（不同等级、稀有度的器官）
- [ ] 测试完整流程（获取→使用→损坏→修复→升级→吞噬）

**已实现部分**：
- ✅ Organ 基础类（work/broken 触发器、cards 卡牌列表）
- ✅ OrganModifier（器官获取、失去、损坏、修复的基础逻辑）

---

## 其他待办任务

卡牌的词条修饰器，其效果要唯一触发器和重要触发器来实现
    卡牌、器官的词条？临时器官之类的？器官可以在战斗内变化。

如何影响卡牌的参数=>属性值？如何让status同步修改卡牌的效果？
效果参数的计算

文档是不是该刷新一下了：事务、item之类的

引入了事务收集器=>trigger事件和相关内容尚未完善！这些事件不会被收集到同一个事务当中
    =>测试触发事件是否会被收集到同一个事件中，需要近一步测试，先做装饰器吧？

卡牌效果无法正常起效时，如何回卷卡牌的丢弃阶段？
    回卷卡牌的使用，例如某个卡牌的效果选择xx，但是取消了

效果：治疗heal效果没做完

item的初步实现，包括基本方案和interaction的流程

卡牌(使用+词条)，遗物(获得+使用)，药水(使用+丢弃)
    卡牌的参数与读取参数的通用函数

organ：
    getOrgan有点怪怪的，现在是get作为Medium的organ对象，但medium可以是别的东西，例如某个卡牌提供的临时器官
回合行为要可以改变：关键触发器来做
    玩家可以选择器官的效果来使用,遗物也是类似的哦

可以给效果等对象的value一个[1,9]这样的值，然后在init这个对象时，通过统一函数来roll取随机值？这样就不用写一长串了？毕竟effect就是随用随销的？

回合行为也要用trigger实现：how？player:在player中添加trigger！比如抽牌和弃牌！
属性也要用trigger实现

阶段开始时回复/不回复生命=>应当与难度有关，某个难度下为玩家添加触发器：阶段开始时回复生命:也可以是关键触发器

核心问题是：导致状态层数减少的对象就是它自己，每回合会自减的状态要怎么修改其自身的层数？

选择卡牌，卡牌目标的筛选
1. 从手牌选择
2. 从某些卡牌中选择
    1. 一个取消显示的按钮，可以用来显示背层的内容

在卡牌or对象旁边显示的提示文本，一个框框
    状态，buff对象

日志：希望可以选择显示事件，希望可以把同一个事件的效果显示在一坨里面
    效果参数显示，分行显示，可以显示更多东西，用对象的方式来定义显示内容吧
调试工具：我想知道对象身上有哪些触发器，来源和介绍等等，最好可以直接通过调试工具移除某些触发器（这样的话，还要考虑某些及其重要的触发器要如何重新获取回来）另外这个移除功能最好是有撤销的功能

卡牌的拖拽使用，而不是现在这样点击使用，拖拽的手感

# 对象创建

# 打牌过程

1. 打出牌，选择目标
    1. 能否打出这张牌
    2. 目标类型，判断目标是否满足条件
    3. 特殊条件的判断

# 战斗流程

1. 玩家回合
    1. 自动顺序
        1. 回合开始
            1. 恢复能量
            2. 抽卡
        2. 自由行动
        3. 结束回合
            1. 丢弃手牌
    2. 各类行动
        1. 打牌
        2. 使用药水
        3. 使用遗物
        4. 使用器官
        5. 手动结束回合
2. 敌人回合
    1. 敌人意图
    2. 敌人如何行动
3. 战斗结束获取奖励

# 爬塔流程

1. 事件组件，抽取房间
2. 各类房间
    1. 水池
    2. 黑市
    3. 其他

# 游戏服务

1. 卡组显示
2. 各类信息显示
3. 待定

# 杂项



