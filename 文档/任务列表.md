[toc]


是否应该让一切都由触发器调用？
=>原作里是一切都是state(状态)，但state的本质都是触发器
=>如何管理这些触发器？
=>status也应该包含触发器
=>触发器行为应该定制
=>一部分效果effect应当脱离触发器，独立出来 
    =>例如“造成伤害”这个效果，应该是这样的流程：创建卡牌>卡牌的效果中包含“打出时对目标造成伤害”的修饰符>创建“打出时”触发器>该触发器调用“对目标造成伤害”的效果>获得卡牌对象，其包含一个触发器，触发时调用效果函数

    =>打出这张卡牌 > 触发“打出时”触发器 > 产生”造车

回合行为也要用trigger实现：how？player！


核心问题是：导致状态层数减少的对象就是它自己！

我希望存储在目标中的状态不包含触发器部分？

状态是怎么存储的？状态应该是什么样的？

这就要求状态分为两种类型：状态对象，状态属性→要不就让它包含吧……？先看看性能如何？



属性当中的状态+状态对象？



例如“中毒“这个状态应该包含哪些内容：

1.该状态当前的属性，例如描述，层数等

2.该状态会做什么？获取该状态时，失去该状态时都会发生什么=>触发器

也就是说我要创建一个“中毒”对象，其包含状态的属性+效果？

然后target获取这个状态之后存储到state属性中。

## 控制状态层数：

一个以状态自身为目标的触发回调函数？在目标获得状态的同时也会获得翻译后的触发器？
例如：回合结束时，该状态默认层数-1
会被翻译为：持有者的回合结束时，对持有者的该状态执行对应的触发器？

属性+行为：行为本质上是触发器？会赋予对象吗？回合结束时xxx?

事件总线？trigger触发的同时响应同样的事件key，然后状态监听事件总线从而触发效果：

优点

	1.	状态与trigger隔离
	1.	之后的遗物或被动器官的效果也可以使用同样的逻辑实现
	1.	事件总线全局可用

缺点

1. 与trigger太隔离了，如何控制执行顺序/执行优先级=>全都在trigger里面至少可以在执行时先通过优先级排列，再依次执行=>可以用事件池来做，所有需要执行的回调函数先放在事件池中，排列后再执行
2. 需要重新制作事件总线系统

~~~
status:{

}
behavior:{
	
}
~~~

事件总线并不复杂？和触发器本质是一样的？都是调用回调函数？

等等，这不是一个东西吗！不就是一个全局一个局部而已吗！无语了！

那就用触发器来做，但是注册和注销触发器可以优化一下：注册时返回注销函数

那在这种情况下state的结构就应该是：

~~~
1.属性
2.方法：获得与失去，分别对应注册触发器和注销触发器
~~~



状态卡，buff对象

卡牌目标的筛选

选择卡牌

1. 从手牌选择
2. 从某些卡牌中选择
    1. 一个取消显示的按钮，可以用来显示背层的内容

在卡牌or对象旁边显示的提示文本，一个框框

卡牌的参数与读取参数的通用函数

遗物和药水



效果是一个带有效果对象的，可以在执行过程中进行编辑的事件过程

行为是一个带有信息的，不会在执行过程中进行编辑的事件过程，行为通常是一个效果的宣言

# 对象创建

# 打牌过程

1. 打出牌，选择目标
    1. 能否打出这张牌
    2. 目标类型，判断目标是否满足条件
    3. 特殊条件的判断

# 战斗流程

1. 玩家回合
    1. 自动顺序
        1. 回合开始
            1. 恢复能量
            2. 抽卡
        2. 自由行动
        3. 结束回合
            1. 丢弃手牌
    2. 各类行动
        1. 打牌
        2. 使用药水
        3. 使用遗物
        4. 使用器官
        5. 手动结束回合
2. 敌人回合
    1. 敌人意图
    2. 敌人如何行动
3. 战斗结束获取奖励

# 爬塔流程

1. 事件组件，抽取房间
2. 各类房间
    1. 水池
    2. 黑市
    3. 其他

# 游戏服务

1. 卡组显示
2. 各类信息显示
3. 待定

# 杂项



