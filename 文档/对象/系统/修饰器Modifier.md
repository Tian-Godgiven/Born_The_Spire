# 修饰器

修饰器是管理实体所持有/获得的属性、物品和状态的【更新】的api。

修饰器的主要作用是提供【更简便地处理获取和失去某物的接口】，并这些过程中【及时+正确地更新实体的信息】。

说的更简单一点，在你获得xx时，你往往会为其添加“获得xx时的效果”，但很可能不想/忘记定义一个“失去xx时，失去这些效果”，而修饰器就是用来在自动地处理“失去xx时，失去添加的那些的效果”的内容

eg：对于器官【厚皮】，你定义了：[在获得这个器官时：生命值+10]
    但你不需要定义[在失去这个器官时：生命值-10]
    因为在失去器官时，我们会同步移除该器官添加的修饰器，并用剩下的内容再次计算生命值

ps：这并不代表你不可以获取/定义“失去xx时”的触发，修饰器仅仅是简化了“撤除获得时的效果”的过程

修饰器的原理是：在你获得or失去某物时，更新修饰器栈，然后重新计算一次修饰器栈内存放的对象们的效果。

## 功能

修饰器的主要功能包含如下3点

1.管理当前获取的对象：包括新增，删除和修改，另外还需要提供查询的接口即增删改查
2.刷新当前的状态：用当前已有的对象和规定的计算方法来刷新持有者的状态，不同的修饰器会有不同的刷新时机，有些会在新增或删除时刷新，有些会特定的时刻刷新（例如战斗结束时会清空所有“状态”然后刷新一次）
3.通过刷新来唯一地修改持有者的某些属性，这样做可以让“修改属性”这一重要操作只在修饰器的权限之下进行


## 基类属性

uuId:唯一Id
source:修饰器的来源
modifierFunc:修饰器在计算时会触发的函数，用其返回值修饰目标
ifDisabled:是否可用，禁用修饰器会使得其不再刷新

此外，在创建修饰器的同时，也会返回如下结构
{
    remove:移除修饰器的函数,
    uuId:该修饰器的唯一Id
}
    
通常情况下，修饰器并不会被直接操作，而是通过使用移除函数将修饰器对象从当前位置删除，但你也可以通过uuId来尝试获取修饰器





# 属性修饰器

即属性Status的修饰器，负责更新对象各类属性值，按照属性值的key值分类，存储于_modifier中

eg:

attack:{
    baseValue:xxxx, //攻击力的基础值
    value:xxxx, //攻击力的当前数值
    _modifier:[……] //攻击力的修饰器
}

在对象获取属性的增减时，本质上是在获取/失去该属性的修饰器，并根据现有的修饰器计算当前的属性值

## 修饰器对象的结构

{
    // 基本
    id: string,                  // 唯一标识
    source: any,                 // 来源对象（卡牌/器官/遗物/事件等）
    statusKey: string,           // 作用的属性键
    targetLayer: "base" |
                 "current",      // 作用的分层，base作用于基础层，current作用于当前层
    modifierType: "additive" | 
                  "multiplicative" | 
                  "function",     // 计算类型，分别为加减法、乘除法、修改函数
    applyMode: "absolute" | "snapshot" , // 应用模式，分别为直接修改和快照修改，快照模式会保存
    timeStamp: number,            // 添加的时间戳，表示顺序，快照类型的修饰器会以此排序
    // 快照记录：只存在于snapshot模式下，快照记录用于在重算时加入当时值作为参考
    snapshotValue?: number,     // 添加当下“当前值”快照（current层常用）
    snapshotBaseValue?: number, // 添加当下“基础值”快照（差值计算可用）
    value: number,   //计算值，若为加减法则直接加此值，若为乘除法则乘以此值，若为修改函数，则将此值作为参数传递
}

## 参与的接口

属性修饰器一般都是通过changeStatus方法添加，并获取卸载函数，在需求的时机卸载的。
我们一般不通过手动卸载属性修饰器来减少对象的属性
每当属性修饰器出现变化时，都会重新计算当前的属性值，当前属性值对外是只读的




# 内容修饰器

通常情况下指物品的修饰器，也包括器官的修饰器

内容修饰器的定义与属性修饰器没有太大的区别，只不过内容修饰器还会存储与其相关的对象实例
例如：【恶性肿瘤】：[在获得这个器官时，获得3张【癌细胞】卡牌]，其对应的卡牌修饰器会存储这3张卡牌的实例对象(创建这3张卡牌对象的步骤并不在这里！)

### 独特属性

路径path：你需要为内容修饰器设定存储路径，通常建议放在：对象/内容/_modifier下
例如：[organ]表示在 entity.organ._modifier 下,
    [item,potion]表示在 entiy.item.potion._modifier 下






