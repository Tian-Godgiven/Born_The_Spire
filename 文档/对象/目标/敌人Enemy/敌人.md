# 敌人 Enemy

在房间中遭遇的敌人与角色一样拥有各种器官，其性能不会发生变化。

## 行动机制

敌人的行动基于器官提供的卡牌系统：

```
敌人拥有器官 → 器官提供卡牌(CardModifier) → AI选择卡牌 → 转换为意图显示 → 执行行动
```

### 卡牌来源

- 敌人从所有**未损坏器官**的 CardModifier 获取可用卡牌
- 器官的 `work` 交互提供的卡牌在器官正常时可用
- 器官损坏时，其提供的卡牌自动不可用（但不会从牌组移除）

### 意图系统 Intent

敌人每回合开始时会决定下回合的意图，并显示给玩家：

```typescript
type Intent = {
    type: "attack" | "defend" | "buff" | "debuff" | "unknown",
    value?: number,        // 显示的数值（伤害/格挡等）
    count?: number,        // 攻击次数（多段攻击）
    actions: Card[]        // 实际要执行的卡牌列表
}
```

意图类型：
- **attack**：攻击意图，显示伤害值
- **defend**：防御意图，显示格挡值
- **buff**：增益意图
- **debuff**：减益意图
- **unknown**：未知意图（特殊敌人）

### 器官损坏的影响

- 器官正常 → 敌人可以使用该器官提供的卡牌
- 器官损坏 → 该器官提供的卡牌无法使用
- **所有器官损坏** → 使用基础攻击与防御（由核心器官提供）

### 多次行动

强大的敌人可能在一个回合中进行复数的行动，通过属性控制：

```typescript
status: {
    "actions-per-turn": 2  // 每回合行动次数，默认为1
}
```

## AI 行为模式

敌人根据行为规则从可用卡牌中选择要使用的卡牌：

### 行为模式类型

1. **随机模式**：从可用卡牌中随机选择
2. **权重模式**：根据卡牌权重随机选择
3. **条件模式**：根据战斗状态（玩家血量、敌人血量等）选择
4. **脚本模式**：预定义的行动序列

### 基础行为

当所有器官损坏时，敌人会使用基础攻击与防御。实现方式：
- 敌人拥有一个**不可损坏的核心器官**
- 核心器官的 `possess` 交互（始终生效）提供基础卡牌

## 敌人类型

### 普通敌人 Normal

- 基础属性和器官
- 战斗胜利后可选择同化其1个未损坏器官

### 精英敌人 Elite

- 实力强劲，拥有强力器官
- 击败时提供遗物奖励
- 可选择同化其1个未损坏器官

### Boss敌人 Boss

- 看守本层终点，实力无比强大
- 往往具备无上限的强化能力
- 击败时可以**指定选择其1个器官**进行同化（无论是否损坏）
- 掉落Boss级遗物

## 实现要点

### 卡牌追踪

CardModifier 添加卡牌时需要记录来源器官：

```typescript
card.sourceOrgan = organ  // 记录提供该卡的器官
```

这样可以在器官损坏时判断哪些卡牌不可用。

### 意图生成

从选择的卡牌生成意图显示：

```typescript
// 分析卡牌效果，生成意图
cardsToIntent(cards: Card[]): Intent {
    // 检查卡牌的主要效果类型
    // 计算总伤害/格挡值
    // 返回意图对象
}
```

### 执行行动

敌人回合时执行意图中的卡牌：

```typescript
executeIntent() {
    for (const card of this.intent.actions) {
        // 打出卡牌，触发效果
        playCard(card, this, targets)
    }
}
```