# 水池房间 (Pool Room)

水池是房间的一种，提供休息和提升的场所。

一个短暂的休憩处

## 基本信息

在层级内，概率出现的特殊房间，每层的数量在2~5个，在Boss房前固定出现。玩家可以在这里选择进行一个行为，部分效果会提供额外的选项。

## 基本行为

1.汲取 (Absorb)
效果：吸收水池中的物质，获得（基础 50 + 层级 × 10）的物质
实现：`ReserveModifier.gainReserve("material", amount, player)`

2.强化 (Upgrade)
效果：消耗自身的物质，提升指定器官的等级，该行为可以重复进行，直到玩家选择离开或物质不足
实现：
  1.显示器官选择界面 (`OrganUpgradeChoice` 组件)
  2.通过 `OrganModifier.upgradeOrgan(organ)` 执行升级
  3.升级成功后递归调用 `onUpgrade()`，连续升级

3.染血 (Blood Mark)
效果：获得红色印记，最大生命值 -10，该行为全局只能进行1次
实现：玩家获得`ifBloodMark=1(true)`的属性 + 玩家最大生命-10
UI提示：染血后，顶部状态栏会在2秒内渐显显示红色的"已染血"文字
    实现位置：`Top/index.vue` 中的 `stateList` computed 属性

PS:水池房间PoolRoom的构造函数会检查当前玩家的ifBloodMark属性，若已染血则会移除染血选项，此外染血行动还会立即移除当前水池房间的选项中的“染血”选项

4.离开

水池房间提供一个独立的"离开"按钮，与房间选项分离，离开水池会开始选择下一层的房间
离开流程：
```typescript
async function leavePool() {
    // 1. 完成当前房间
    await nowGameRun.completeCurrentRoom()
    //前往下一层房间
    await goToNextStep()
}
```

## 可配置项

在

```typescript
interface PoolRoomConfig extends RoomConfig {
    type: "pool"
    absorbAmount?: number       // 汲取物质数量（默认根据层级计算）
    allowBloodMark?: boolean    // 是否允许染血（默认 true）
}
```

## 相关文件

逻辑：src/core/objects/room/PoolRoom.ts
UI：src/ui/page/Scene/running/PoolRoom.vue
染血状态：src/ui/page/Scene/running/Top/index.vue

## 注意事项

1. **选项组响应式**：`ChoiceGroup.choices` 是响应式数组，可以动态添加/移除选项
2. **状态持久化**：`ifBloodMark` 状态会在整个游戏局中保持，确保染血的全局唯一性
3. **房间切换**：离开水池后必须进入房间选择，不能直接进入下一个房间
4. **升级递归**：升级功能使用递归调用，允许玩家连续升级多个器官

## 水池房间注册

位置：`src/static/registry/rooms/initPoolRooms.ts`

水池房间的注册包括类型注册和配置注册

### 类型注册

```typescript
import { PoolRoom } from "@/core/objects/room/PoolRoom"
import { roomRegistry } from "../roomRegistry"

roomRegistry.registerRoomType("pool", PoolRoom)
```

### 配置注册

水池房间注册默认配置

```typescript
roomRegistry.registerRoomConfig({
    key: "pool_default",
    type: "pool",
    name: "水池",
    description: "可以休息和提升的地方"
})
```

### 配置文件位置

水池房间类：`src/core/objects/room/PoolRoom.ts`
水池房间 UI：`src/ui/page/Scene/running/PoolRoom.vue`

### 自定义水池配置

可以注册自定义的水池配置

```typescript
roomRegistry.registerRoomConfig({
    key: "pool_special",
    type: "pool",
    name: "特殊水池",
    description: "提供更多物质的水池",
    customData: {
        absorbAmount: 200,      // 自定义汲取数量
        allowBloodMark: false   // 禁用染血
    }
})
```

配置会在应用启动时自动注册到房间注册表