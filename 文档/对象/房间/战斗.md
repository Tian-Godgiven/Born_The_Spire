[toc]

# 战斗

战斗为回合制进行，以角色的回合为起始，一直持续到一方的物质归0。

角色：每回合获得能量，抽取卡牌，打出手牌，丢弃手牌，期间可以选择使用遗物或器官的主动能力，亦或者使用药水。 敌人：每回合会规律地使用指定的器官卡牌作为行动，也会在指定的条件下使用器官的主动能力。

战斗奖励：在战斗胜利时，角色可以获得如下奖励

- 吞噬物质：获得一定量的物质，随着层级推进不断增加，强大的精英敌人会掉落更多物质
- 同化器官：从敌人拥有的器官中抽取3个，选择其1进行同化，也可以选择吞噬器官获得额外的物质
- 遗物奖励：仅限击败精英敌人时可选，从遗物池中随机抽取一个不重复的遗物奖励
- Boss器官：从击败的Boss敌人身上，指定地选择1个器官进行同化，与同化器官选项互斥
- Boss遗物：从3个随机抽取的Boss级遗物中选择1个

## 战斗房间注册

位置：`src/static/registry/rooms/initBattleRooms.ts`

战斗房间的注册包括类型注册和配置注册

### 类型注册

```typescript
import { BattleRoom } from "@/core/objects/room/BattleRoom"
import { roomRegistry } from "../roomRegistry"

roomRegistry.registerRoomType("battle", BattleRoom)
```

### 配置注册

战斗房间配置来自 battleList

```typescript
import { battleList } from "@/static/list/room/battle/battleList"

// battleList 数据结构
const battleList = [
    {
        key: "battle_normal_001",
        name: "普通战斗",
        description: "遭遇了敌人",
        battleType: "normal",
        enemyConfigs: [{ key: "enemy_slime", level: 1 }]
    },
    // ...
]

// 批量注册
battleList.forEach(battle => {
    roomRegistry.registerRoomConfig({
        key: battle.key,
        type: "battle",
        name: battle.name,
        description: battle.description,
        customData: {
            battleType: battle.battleType,
            enemyConfigs: battle.enemyConfigs
        }
    })
})
```

### 配置文件位置

战斗房间配置：`src/static/list/room/battle/battleList.ts`

### 添加新战斗

在 battleList.ts 中添加新的战斗配置

```typescript
{
    key: "battle_elite_new",
    name: "新精英战斗",
    description: "强大的新敌人",
    battleType: "elite",
    enemyConfigs: [
        { key: "enemy_new_elite", level: 5 }
    ]
}
```

配置会在应用启动时自动注册到房间注册表